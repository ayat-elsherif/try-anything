import videojs from"video.js";var Hlsjs=require("hls.js");"undefined"!=typeof window&&(window.videojs=videojs);var registerSourceHandler=function(e){var r={};function n(n,t){t.name_="nuevoHlsjs";var o,i=t.el(),a={},s=null,l=null,u=null,d=null,c=null,f=null,v=e(t.options_.playerId),g=v.qualities;t.hls={};var p=!1;function h(e){if(void 0!==r[e])for(var n=0;n<r[e].length;n++)r[e][n](v,o)}function E(e){if(1===a[Hlsjs.ErrorTypes.MEDIA_ERROR]){console.info("trying to recover media error");o.recoverMediaError()}else if(2===a[Hlsjs.ErrorTypes.MEDIA_ERROR]){console.info("2nd try to recover media error (by swapping audio codec");o.swapAudioCodec();o.recoverMediaError()}else if(a[Hlsjs.ErrorTypes.MEDIA_ERROR]>2){console.info("bubbling media error up to VIDEOJS");t.error=function(){return e};t.trigger("error")}}function b(e,r){var n={message:"HLS.js error: "+r.type+" - fatal: "+r.fatal+" - "+r.details};console.error(n.message);a[r.type]?a[r.type]+=1:a[r.type]=1;if(r.fatal)switch(r.type){case Hlsjs.ErrorTypes.NETWORK_ERROR:console.info("bubbling network error up to VIDEOJS");n.code=2;t.error=function(){return n};t.trigger("error");break;case Hlsjs.ErrorTypes.MEDIA_ERROR:n.code=3;E(n);break;default:o.destroy();console.info("bubbling error up to VIDEOJS");t.error=function(){return n};t.trigger("error")}}function m(e){}function y(e){return e.height?e.height+"p":e.width?Math.round(9*e.width/16)+"p":e.bitrate?e.bitrate/1e3+"kbps":0}function w(e,r){if(v.qualities.length>0){"boolean"==typeof r&&(v.qualitie[e].enabled=r);return v.qualities[e].enabled}return!1}function k(){if(l){g=v.qualities;v.qualities=[];if(g){t.hls={};for(var e=0;e<l.levels.length;e++){var r=l.levels[e],n="vjs-"+e,o={id:n,index:n,label:n,width:r.width,height:r.height,bandwidth:r.bitrate,bitrate:r.bitrate,enabled:!1};o.enabled=w.bind(this,e);v.qualities.push(o);g.push(o)}}}}function T(e,r){if(v.qualities.length>0){v.qualityIndex=r.level;v.trigger("qualityChange")}}function R(){if(l){var e=[];if(l.levels.length>1){var r={id:-1,label:"auto",selected:-1===o.manualLevel};e.push(r)}l.levels.forEach(function(r,n){var t={};t.id=n;t.selected=n===o.manualLevel;t.label=y(r);e.push(t)});var n={qualityData:{video:e},qualitySwitchCallback:m};t.trigger("loadedqualitydata",n);i.removeEventListener("playing",R);v.qualities=g;v.trigger("levelsLoaded")}}function j(){for(var e=t.audioTracks(),r=0;r<e.length;r++)if(e[r].enabled){o.audioTrack=r;break}}function _(){var r=o.audioTracks,n=t.audioTracks();if(r.length>1&&0===n.length){for(var i=0;i<r.length;i++)n.addTrack(new e.AudioTrack({id:i,kind:"alternative",label:r[i].name||r[i].lang,language:r[i].lang,enabled:i===o.audioTrack}));n.addEventListener("change",j)}}function L(e){return e.label?e.label:e.language}function H(e,r){return L(e)===L(r)&&e.kind===r.kind}function O(){for(var e=v.textTracks(),r=null,n=0;n<e.length;n++)if("showing"===e[n].mode){r=e[n];break}for(var t=i.textTracks,o=0;o<t.length;o++)"subtitles"!==t[o].kind&&"captions"!==t[o].kind||(t[o].mode=r&&H(t[o],r)?"showing":"disabled")}function C(){o.startLoad(-1);i.removeEventListener("play",C)}function D(e){for(var r={},n=Object.keys(e),t=0;t<n.length;t++)r[n[t]]=e[n[t]];return r}function S(e){for(var r=[],n=0;n<e.length;n++)"subtitles"!==e[n].kind&&"captions"!==e[n].kind||r.push(e[n]);return r}function A(){for(var e=S(i.textTracks),r=v.textTracks(),n=0;n<e.length;n++){for(var t=!1,o=0;o<r.length;o++)if(H(e[n],r[o])){t=!0;break}if(!t){var a=e[n];v.addRemoteTextTrack({kind:a.kind,label:L(a),language:a.language,srclang:a.language},!1)}}O();if(!p){r.addEventListener("change",O);p=!0}}function x(e,r){l=r;k()}function I(e){return{newCue:function(r,n,t,o){for(var i,a,s,l=window.VTTCue||window.TextTrackCue,u=0;u<o.rows.length;u++){s="";if(!(i=o.rows[u]).isEmpty()){for(var d=0;d<i.chars.length;d++)s+=i.chars[d].uchar;a=new l(n,t,s.trim());if(null!=e&&"object"==typeof e)for(var c=Object.keys(e),f=0;f<c.length;f++)a[c[f]]=e[c[f]];r.addCue(a);t===n&&r.addCue(new l(t+5,""))}}}}}function M(){var e=v.srOptions_&&v.srOptions_.hlsjsConfig||t.options_.hlsjsConfig;f=e?D(e):{};-1!==["","auto"].indexOf(i.preload)||i.autoplay||void 0!==f.autoStartLoad||(f.autoStartLoad=!1);var r=v.srOptions_&&v.srOptions_.captionConfig||t.options_.captionConfig;r&&(f.cueHandler=I(r));!1===f.autoStartLoad&&i.addEventListener("play",C);var l="undefined"!=typeof InstallTrigger,g=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime),p=g&&-1!==navigator.userAgent.indexOf("Edg");f.capLevelToPlayerSize||(f.capLevelToPlayerSize=!0);f.smoothQualityChange||(f.smoothQualityChange=!0);if(!0===f.capLevelToPlayerSize&&(l||g||p)){f.maxBufferLength||(f.maxBufferLength=60);f.maxMaxBufferLength||(f.maxMaxBufferLength=60)}i.addEventListener("playing",R);o=new Hlsjs(f);v.hlsjs=o;h("beforeinitialize");o.on(Hlsjs.Events.ERROR,function(e,r){b(e,r,t,a)});o.on(Hlsjs.Events.AUDIO_TRACKS_UPDATED,_);o.on(Hlsjs.Events.MANIFEST_PARSED,x);o.on(Hlsjs.Events.LEVEL_LOADED,function(e,r){f.liveSyncDuration?c=f.liveSyncDuration:f.liveSyncDurationCount&&(c=f.liveSyncDurationCount*r.details.targetduration);u=r.details.live;d=r.details.totalduration;s=u?1/0:r.details.totalduration});o.once(Hlsjs.Events.FRAG_LOADED,function(){t.trigger("loadedmetadata")});o.on(Hlsjs.Events.LEVEL_SWITCHED,T);o.attachMedia(i);i.textTracks.addEventListener("addtrack",A);o.loadSource(n.src)}function q(){M()}this.duration=function(){return s||i.duration||0};this.seekable=function(){if(o.media){if(!u)return e.createTimeRanges(0,o.media.duration);var r=Math.round(o.media.duration-d),n=Math.round(o.media.duration-c);return e.createTimeRanges(r,n)}return e.createTimeRanges()};this.dispose=function(){i.removeEventListener("play",C);i.textTracks.removeEventListener("addtrack",A);i.removeEventListener("playing",R);v.textTracks().removeEventListener("change",O);p=!1;v.audioTracks().removeEventListener("change",j);o.destroy()};i.addEventListener("error",function(e){var r,n=e.currentTarget.error;switch(n.code){case n.MEDIA_ERR_ABORTED:r="You aborted the video playback";break;case n.MEDIA_ERR_DECODE:r="The video playback was aborted due to a corruption problem or because the video used features your browser did not support";E(n);break;case n.MEDIA_ERR_NETWORK:r="A network error caused the video download to fail part-way";break;case n.MEDIA_ERR_SRC_NOT_SUPPORTED:r="The video could not be loaded, either because the server or network failed or because the format is not supported";break;default:r=n.message}console.error("MEDIA_ERROR: ",r)});q()}n.addHook=function(e,n){r[e]=r[e]||[];r[e].push(n)};n.removeHook=function(e,n){if(void 0===r[e])return!1;var t=r[e].indexOf(n);if(-1===t)return!1;r[e].splice(t,1);return!0};if(Hlsjs.isSupported()){var t;if("function"==typeof e.getTech)t=e.getTech("Html5");else{if("function"!=typeof e.getComponent){console.error("Not supported version if video.js");return}t=e.getComponent("Html5")}if(!t){console.error("Not supported version if video.js");return}t.registerSourceHandler({canHandleSource:function(e){var r=/\.m3u8/i;return/^application\/x-mpegURL|application\/vnd\.apple\.mpegurl$/i.test(e.type)?"probably":r.test(e.src)?"maybe":""},handleSource:function(e,r){r.hlsProvider&&r.hlsProvider.dispose();r.hlsProvider=new n(e,r);return r.hlsProvider}},0);e.Html5Hlsjs=n}else console.warn("Hls.js is not supported in this browser!")};function nuevoHlsjsConfigHandler(e){var r=this;if(e){r.srOptions_||(r.srOptions_={});r.srOptions_.hlsjsConfig||(r.srOptions_.hlsjsConfig=e.hlsjsConfig);r.srOptions_.captionConfig||(r.srOptions_.captionConfig=e.captionConfig)}}var registerConfigPlugin=function(e){(e.registerPlugin||e.plugin)("nuevoHls",nuevoHlsjsConfigHandler)};if("undefined"!=typeof window&&window.videojs){registerConfigPlugin(window.videojs);registerSourceHandler(window.videojs)}