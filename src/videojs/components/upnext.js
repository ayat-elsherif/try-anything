import videojs from"video.js";function factory(e,n){var l,i,t,a,r,d=!1,s=!1,o="Up Next",v=30,c=0;if(n){e.upnext.title=function(e){e.length>1&&(o=e)};e.upnext.offset=function(e){parseInt(e,10)>0&&(v=e)};if(!k(n)&&"undefined"!==n.title&&("undefined"!==n.sources||"undefined"!==n.url)&&"undefined"!==n.poster){var u=[];u[0]=n;n=u}if(k(n)){for(var p=[],f=0;f<n.length;f++)if(n[f].title&&(n[f].sources||n[f].url)&&n[f].poster){p.push(n[f]);var h=y("img");h.src=n[f].poster;n[f].img=h}if(p.length>1){i=p[1];c=1}else i=p[0];var m=null,g=null,j=null,C=null;if(0!==p.length){videojs.dom.addClass(e.el(),"vjs-up-next");e.on("timeupdate",function(){if(!videojs.dom.hasClass(e.el(),"vjs-ad-playing")&&!videojs.dom.hasClass(e.el(),"vjs-dai")&&!(p.length<1||p.length>1&&c===p.length-1||b())){!0!==d&&e.currentTime()>0&&e.duration()-e.currentTime()<v&&I();if(d&&e.duration()-e.currentTime()>v){if(m){m.onclick=null;m.parentNode.removeChild(m);m=null}d=!1}}});e.on("ended",function(){videojs.dom.hasClass(e.el(),"vjs-ad-playing")||videojs.dom.hasClass(e.el(),"vjs-dai")||N()});var x=function n(){if(m){m.onclick=null;m.parentNode.removeChild(m)}if(g){g.onclick=null;g.parentNode.removeChild(g)}clearInterval(t);e.off("dispose",n)};e.on("dispose",x)}}else console.log("Error: Upnext - Invalid list array")}function y(e,n,l){var i=document.createElement(e);n&&(i.className=n);l&&(i.innerHTML=l);return i}function k(e){return"[object Array]"===Object.prototype.toString.call(e)}function b(){return e.duration()===1/0||"8"===videojs.browser.IOS_VERSION&&0===e.duration()}function I(){if(!d&&!s){m=y("div","vjs-upnext");var n=i.img;n.setAttribute("alt",i.title);m.appendChild(n);if(i.duration){var l=y("div","next-dur",i.duration);m.appendChild(l)}var t=y("span","upnext-right",'<span class="nextup">'+o+'</span><span class="vjs-up-title">'+i.title+"</span>");m.appendChild(t);if(i.nextURL){var a=y("a");a.href=i.nextURL;a.target="_blank";i.target?a.target=i.target:a.target="_blank";m.appendChild(a)}e.el().appendChild(m);setTimeout(()=>{m.className="vjs-upnext vjs-upnext-show"},500);d=!0;m.onclick=function(){if(p[0].nextURL)a&&a.click();else{e.changeSource(i);m.onclick=null;e.el().removeChild(m);m=null;e.play();if(1===p.length){s=!0;videojs.dom.removeClass(e.el(),"vjs-up-next");p.splice(0,1)}else c<p.length-1&&(i=p[++c])}}}}function N(){if(0!==p.length){videojs.dom.addClass(e.controlBar.el_,"vjs-hidden");videojs.dom.addClass(e.el(),"vjs-up-next");1===p.length&&(s=!0);if(m){m.onclick=null;m.parentNode.removeChild(m);m=null}j=y("div","vjs-nextup");var n=y("div","next-close");n.innerHTML="x";j.appendChild(n);var t=y("div","next-header","<span>Up Next</span>");j.appendChild(t);g=y("div","vjs-fullnext");j.appendChild(g);var d=y("div","respo");(a=y("div","img")).style.backgroundImage="url("+i.poster+")";d.appendChild(a);g.appendChild(d);if(i.duration){var o=y("div","full-dur",i.duration);g.appendChild(o)}var v=y("div","next-title",i.title);g.appendChild(v);if(1===p.length&&i.nextURL){(r=y("a")).href=i.nextURL;i.target?r.target=i.target:r.target="_blank";g.appendChild(r)}var u,f=y("div","progress");f.innerHTML='<svg viewBox="0 0 84 84" preserveAspectRatio="xMinYMin meet"><circle class="circle1" cx="40" cy="40" r="40"></circle><circle id="circle2" class="circle2" cx="40" cy="40" r="40"></circle><g style="transform: translate(77%,26%) rotate(90deg) scale(3, 3);fill: #fff;"><path d="M3 12.2V3.8c0-.8.8-1.3 1.5-.9l7.1 4.2c.6.4.6 1.3 0 1.7L4.5 13c-.7.5-1.5 0-1.5-.8z"></path></g></svg>';g.appendChild(f);d.onclick=function(){if(1===p.length&&r)r.click();else{i=p[c];L()}};n.onclick=function(){clearInterval(h);g.onclick=null;if(j){j.parentNode.removeChild(j);j=null}if(C){C.parentNode.removeChild(C);C=null}e.play();e.one("playing",function(n){videojs.dom.removeClass(e.el(),"vjs-up-next");videojs.dom.removeClass(e.controlBar.el_,"vjs-hidden");s=!0;if(1===p.length){s=!0;p.splice(0,1);i=null}})};C=y("div","next-overlay");var h,x=2*Math.PI*170;e.el().appendChild(C);e.el().appendChild(j);if(p.length>1){var k="vjs-nav-prev",b="vjs-nav-next";0===c&&(k="vjs-nav-prev disabled");c===p.length-1&&(b="vjs-nav-next disabled");var I=y("div",k,'<div class="icon"></div>'),N=y("div",b,'<div class="icon"></div>');C.appendChild(I);C.appendChild(N);N.onclick=function(){if(++c>p.length-1)c=p.length-1;else{c===p.length-1&&videojs.dom.addClass(N,"disabled");videojs.dom.removeClass(I,"disabled");clearInterval(h);u&&u.removeAttribute("stroke-dasharray");A(c,"next")}};I.onclick=function(){if(--c<0)c=0;else{clearInterval(h);u&&u.removeAttribute("stroke-dasharray");0===c&&videojs.dom.addClass(I,"disabled");videojs.dom.removeClass(N,"disabled");A(c,"prev")}};function A(e,n){var l=y("div","img");l.style.backgroundImage="url("+p[e].poster+")";l.style.left="next"===n?"100%":"-100%";var i,t=100,r=-100;d.appendChild(l);function s(){if((t-=3)<=0){cancelAnimationFrame(i);l.style.left=0;a.parentNode.removeChild(a);a=l;l=null}else{t>0&&(l.style.left=t+"%");i=requestAnimationFrame(s)}}function c(){if((r+=3)>=0){cancelAnimationFrame(i);l.style.left=0;a.parentNode.removeChild(a);a=l;l=null}else{r<0&&(l.style.left=r+"%");i=requestAnimationFrame(c)}}i="next"===n?requestAnimationFrame(s):requestAnimationFrame(c);v.innerHTML=p[e].title;if(p[e].duration&&o){o.innerHTML=p[e].duration;videojs.dom.removeClass(o,"vjs-hidden")}else o&&videojs.dom.addClass(o,"vjs-hidden")}}l=0;c===p.length-1&&1!==p.length||(h=setInterval(function(){u=document.getElementById("circle2");if(l<.25){u.setAttribute("stroke-dasharray",x*l+" "+x*(1-l));l+=.001}else{clearInterval(h);1===p.length&&r?r.click():L()}},25))}function L(){clearInterval(h);g.onclick=null;if(j){j.parentNode.removeChild(j);j=null}if(C){C.parentNode.removeChild(C);C=null}e.changeSource(i);e.play();e.one("playing",function(n){videojs.dom.removeClass(e.el(),"vjs-up-next");videojs.dom.removeClass(e.controlBar.el_,"vjs-hidden");if(1===p.length){s=!0;p.splice(0,1);i=null}});p.length>1&&c<p.length-1&&(i=p[++c])}}}var registerPlugin=videojs.registerPlugin||videojs.plugin,plugin=function(e){this.ready(function(){factory(this,e)})};registerPlugin("upnext",plugin);export default plugin;